<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sevak Registration</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <form id="nonesevakForm">
        <input type="hidden" name="sevak_id" id="sevak_id" value="">
        <fieldset>
            <h4>Personal Information</h4>
            <label for="first_name">First Name :<span>*</span></label>
            <input type="text" id="first_name" title="Please Provide First Name" required name="first_name" value="">
            <br>
            <label for="middle_name">Middle Name :<span>*</span></label>
            <input type="text" title="Please Provide Middle Name" id="middle_name" name="middle_name" value="">
            <br>
            <label for="last_name">Last Name :<span>*</span></label>
            <input type="text" id="last_name" title="Please Provide Last Name" name="last_name" value="">
            <br>
            <label for="birth_date">Birth Date :<span>*</span></label>
            <input type="date" id="birth_date" title="Select Birthdate" name="birth_date" required value="">
            <br>
            <label for="blood_group_id">Blood Group :</label>
            <select name="blood_group_id" id="blood_group_id">
                <option value="">Select Blood Group</option>
            </select>
            <br>
            <label for="gender">Gender :</label>
            <select name="gender" id="gender">
                <option value="M">Male</option>
                <option value="F">Female</option>
            </select>
            <br>
            <label>Marital Status:</label>
            <select id="marital_status_id" name="marital_status_id"></select><br>

            <div id="maritalStatusDate">
                <label for="marital_status_id" id="engagedDate">
                    Engaged Date :
                </label>
                <label for="marital_status_id" id="marriedDate">
                    Marriage Date :
                </label>
                <input type="date" id="marital_date" name="marital_date" autocomplete="off">

            </div><br>
            <label for="sevak_photo">NonSevak Photo :</label>
            <input type="file" id="sevak_photo" name="sevak_photo">
            <br>

            <h4>Current Address</h4>
            <label for="address1">Address:</label>
            <input type="text" name="address1" id="address1" placeholder="Enter Current Address" value="">
            <br>
            <label for="city_id">City/Village :</label>
            <select name="city_id" id="city_id">
                <option value="">Select City</option>
            </select>
            <br>
            <label for="city_area_id">City Area :</label>
            <select name="city_area_id" id="city_area_id">
                <option value="">Select City Area</option>
            </select>
            <br>
            <label for="taluka_id">Taluka :</label>
            <input type="hidden" name="taluka_id" id="taluka_id" value="">
            <input type="text" name="taluka_name" id="taluka_name" readonly value="">
            <br>
            <label for="district_id">District :</label>
            <input type="hidden" name="district_id" id="district_id" value="">
            <input type="text" name="district_name" id="district_name" readonly value="">
            <br>
            <label for="state_id">State :</label>
            <input type="hidden" name="state_id" id="state_id" value="">
            <input type="text" name="state_name" id="state_name" readonly value="">
            <br>
            <label for="country_id">Country :</label>
            <input type="hidden" name="country_id" id="country_id" value="">
            <input type="text" name="country_name" id="country_name" readonly value="">
            <br>
            <label for="pincode">Pincode :</label>
            <select name="pincode" id="pincode">
                <option value="">Select Pincode</option>
            </select>
            <br>

            <h4>Contact</h4>
            <label for="contact_mobile1">Mobile 1 :</label>
            <select name="mobile1_country_code" id="mobile1_country_code">
                <option value="">---</option>
            </select>
            <input type="text" pattern="\d*" name="contact_mobile1" id="contact_mobile1" placeholder="Mobile 1"
                value="">
            <br>
            <label for="contact_mobile2">Mobile 2 :</label>
            <select name="mobile2_country_code" id="mobile2_country_code">
                <option value="">---</option>
            </select>
            <input type="text" name="contact_mobile2" id="contact_mobile2" placeholder="Mobile 2" pattern="\d*"
                value="">
            <br>
            <label for="contact_phone_1">Office Phone 1 :</label>
            <input type="text" name="contact_phone_1" id="contact_phone_1" placeholder="Office Phone 1" value="">
            <br>
            <label for="contact_phone_2">Office Phone 2 :</label>
            <input type="text" name="contact_phone_2" id="contact_phone_2" placeholder="Office Phone 2" value="">
            <br>
            <label for="contact_res_phone1">Residence Phone 1 :</label>
            <input type="text" name="contact_res_phone1" id="contact_res_phone1" placeholder="Residence Phone 1"
                value="">
            <br>
            <label for="contact_res_phone2">Residence Phone 2 :</label>
            <input type="text" name="contact_res_phone2" id="contact_res_phone2" placeholder="Residence Phone 2"
                value="">
            <br>
            <label for="contact_per_mail">Personal Email :</label>
            <input type="email" name="contact_per_mail" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                id="contact_per_mail" required value="">
            <span><em>Personal Email is used as Login ID</em></span>
            <br>
            <label for="contact_bus_mail">Business Email :</label>
            <input type="email" name="contact_bus_mail" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                id="contact_bus_mail" value="">
            <br>
            <label for="contact_whatsapp_no">Whatsapp No :</label>
            <select name="whatsapp_country_code" id="whatsapp_country_code">
                <option value="">---</option>
            </select>
            <input type="text" placeholder="Whatsapp No" name="contact_whatsapp_no" id="contact_whatsapp_no"
                pattern="\d*" value="">
            <br>

            <h4>Role</h4>
            <label for="role_id">Role :<span>*</span></label>
            <select name="role_id" id="role_id" required title="Select Role">
                <option value="">Select Role</option>
                <option value="1">Admin</option>
                <option value="8">Sub Admin</option>
                <option value="15">Database Operator</option>
            </select>
            <br>
            <label for="password">Password :<span>*</span></label>
            <input name="password" id="password" value="">
            <br>
            <label for="login_active">Login Active :</label>
            <input type="checkbox" id="login_active" name="login_active" />
            <br> <br>

            <button type="submit">Save</button>
        </fieldset>
    </form>

    <script>


        // ----------------- Load Selects -----------------
        function loadSelect(url, selectId, options) {
            const {
                textKey,
                valueKey,
                placeholder = '-- Select --',
                selectedValue = null,
                joinWith = ' - '
            } = options;

            fetch(url)
                .then(res => res.json())
                .then(items => {
                    const select = document.getElementById(selectId);
                    select.innerHTML = `<option value="">${placeholder}</option>`;
                    items.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item[valueKey];
                        option.textContent = Array.isArray(textKey) ? textKey.map(k => item[k]).join(joinWith) : item[textKey];
                        if (selectedValue && selectedValue == item[valueKey]) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    });
                });
        }

        loadSelect('/city/list', 'city_id', { textKey: 'city_name', valueKey: 'city_id' });
        loadSelect('/blood_group/list', 'blood_group_id', { textKey: 'blood_group_name', valueKey: 'blood_group_id' });
        loadSelect('/marital_status/list', 'marital_status_id', { textKey: 'marital_status_name', valueKey: 'marital_status_id' });

        function loadCountryCode(selectId) {
            fetch('/country/list')
                .then(res => res.json())
                .then(countries => {
                    const select = document.getElementById(selectId);
                    select.innerHTML = '<option value="">-- Select country code --</option>';
                    countries.forEach(country => {
                        const option = document.createElement('option');
                        option.value = country.dialing_code;
                        option.textContent = country.country_name + ' - ' + country.dialing_code;
                        select.appendChild(option);
                    });
                });
        }
        loadCountryCode('mobile1_country_code');
        loadCountryCode('mobile2_country_code');
        loadCountryCode('whatsapp_country_code');


        function handleCityChange(cityId, areaSelectId, pincodeSelectId, prefix = '') {
            if (!cityId) return;

            // Areas
            fetch(`/common/getcityareabycity?city_id=${cityId}`)
                .then(res => res.json())
                .then(cityAreas => {
                    const areaSelect = document.getElementById(areaSelectId);
                    areaSelect.innerHTML = '<option value="">-- Select City Area --</option>';
                    cityAreas.forEach(ca => {
                        const option = document.createElement('option');
                        option.value = ca.city_area_id;
                        option.textContent = ca.area_name;
                        areaSelect.appendChild(option);

                    });

                });




            // Pincode
            fetch(`/common/getpincodebycity?city_id=${cityId}`)
                .then(res => res.json())
                .then(pincodes => {
                    const pincodeSelect = document.getElementById(pincodeSelectId);
                    pincodeSelect.innerHTML = '<option value="">-- Select Pincode --</option>';
                    pincodes.forEach(pin => {
                        const option = document.createElement('option');
                        option.value = pin.pin_id;
                        option.textContent = pin.pincode;
                        pincodeSelect.appendChild(option);
                    });
                });

            // Taluka/District/State/Country
            fetch(`/common/getcitydetails?city_id=${cityId}`)
                .then(res => res.json())
                .then(details => {
                    if (!details || details.length === 0) return;
                    const d = details[0];

                    document.getElementById(prefix + 'taluka_name').value = d.taluka_name || "";
                    document.getElementById(prefix + 'taluka_id').value = d.taluka_id || "";

                    document.getElementById(prefix + 'district_name').value = d.district_name || "";
                    document.getElementById(prefix + 'district_id').value = d.district_id || "";

                    document.getElementById(prefix + 'state_name').value = d.state_name || "";
                    document.getElementById(prefix + 'state_id').value = d.state_id || "";

                    document.getElementById(prefix + 'country_name').value = d.country_name || "";
                    document.getElementById(prefix + 'country_id').value = d.country_id || "";
                });


        }


        document.getElementById('city_id').addEventListener('change', () =>
            handleCityChange(document.getElementById('city_id').value, 'city_area_id', 'pincode', '')
        );


        $('#maritalStatusDate').hide();

        $('#addmaritalstatus').on('change', function () {
            const val = $(this).val();

            if (val === "3") { // Engaged
                $('#maritalStatusDate').show();
                $('#marital_date').prop('required', true);
                $('#engagedDate').show();
                $('#marriedDate').hide();
            } else if (val === "2") { // Married
                $('#maritalStatusDate').show();
                $('#marital_date').prop('required', true);
                $('#marriedDate').show();
                $('#engagedDate').hide();
            } else { // Single, Divorced, etc.
                $('#maritalStatusDate, #engagedDate, #marriedDate').hide();
                $('#marital_date').prop('required', false);
            }
        });


        document.getElementById('nonesevakForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);

            // Log formData for debugging
            for (let [key, value] of formData.entries()) {
                console.log(key, value);
            }

            fetch('/SevakRegistration/addNoneSevak', {
                method: 'POST',
                body: formData
            })
                .then(res => res.json())
                .then(result => {
                    if (result.success) {
                        alert('Sevak registered successfully!');
                        // window.location.reload();
                        window.location.href = "/SevakRegistration/ViewNoneSevak";
                    } else {
                        alert('Error: ' + result.message);
                    }
                });
        });


    </script>



</body>

</html>